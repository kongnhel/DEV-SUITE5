<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | Royal Cyber 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Freehand&family=Kantumruy+Pro:wght@300;400;700&family=Space+Grotesk:wght@300;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            --primary: <%= theme || '#ff4d00' %>; /* Robot Fire Orange */
            --secondary: #ff9100;
            --bg-dark: #020617;
            --robot-glow: rgba(255, 77, 0, 0.4);
        }
        
        body {
            font-family: "Kantumruy Pro", sans-serif;
            background: var(--bg-dark);
            color: #f3f4f6;
            overflow-x: hidden;
        }

        /* --- ROBOT FIRE STYLES --- */
        .shimmer-fire {
            background: linear-gradient(90deg, #fff, var(--primary), var(--secondary), #fff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: fireShine 4s linear infinite;
        }
        @keyframes fireShine { to { background-position: 200% center; } }

        .active-link {
            color: var(--primary) !important;
            text-shadow: 0 0 20px var(--primary);
            position: relative;
        }
        .active-link::after {
            content: '';
            position: absolute;
            bottom: -8px; left: 0; width: 100%; height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            box-shadow: 0 0 15px var(--primary);
            border-radius: 99px;
        }

        .nav-glass {
            background: rgba(2, 6, 23, 0.85);
            backdrop-filter: blur(40px);
            border-bottom: 2px solid rgba(255, 77, 0, 0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        .user-avatar {
            border: 2px solid var(--primary);
            box-shadow: 0 0 25px var(--robot-glow);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .user-avatar:hover { transform: rotate(15deg) scale(1.15); box-shadow: 0 0 50px var(--primary); }

        /* --- MOBILE DROPDOWN FIX --- */
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            padding-top: 15px;
            min-width: 240px;
            z-index: 100;
        }
        .dropdown-inner {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(50px);
            border: 2px solid rgba(255, 77, 0, 0.2);
            border-radius: 35px;
            padding: 16px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.9);
        }
        /* Hover ·ûä·üÜ·ûé·ûæ·ûö·ûÄ·û∂·ûö·ûè·üÇ·ûõ·ûæ Desktop */
        @media (hover: hover) {
            .profile-group:hover .dropdown-content { display: block; animation: fireUp 0.4s ease-out; }
        }
        /* Class ·ûü·ûò·üí·ûö·û∂·ûî·üã Toggle ·ûõ·ûæ Mobile */
        .profile-group.active .dropdown-content { display: block; animation: fireUp 0.4s ease-out; }
        @keyframes fireUp {
            from { opacity: 0; transform: translateY(20px) scale(0.95); filter: blur(10px); }
            to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div class="fixed inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(255,77,0,0.08)_0%,transparent_60%)] -z-20"></div>

    <nav class="sticky top-0 z-50 nav-glass px-6 py-5">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="/" class="group">
                    <h1 class="text-xl md:text-3xl font-black tracking-tighter shimmer-fire italic uppercase">
                        ROBOT SUITE <span class="text-[10px] bg-orange-600 px-2 py-0.5 rounded text-black">FIRE V2.6</span>
                    </h1>
                </a>
            </div>

            <div class="hidden lg:flex items-center gap-10 text-[10px] font-black uppercase tracking-[0.2em]">
                <% 
                const tools = [
                    { name: 'Reviewer', path: '/', key: 'reviewer', desc: 'Fix ·ûÄ·ûº·ûä·û±·üí·ûô·ûä·ûæ·ûö·ûÜ·üÅ·üá·ûü·ûì·üí·ûí·üÑ·ûü·ûì·üí·ûí·üÖ' },
                    { name: 'Culture', path: '/culture', key: 'culture', desc: '·ûî·ûæ·ûÄ·ûÄ·üí·ûö·û∂·üÜ·ûÑ·ûò·û∂·ûü·ûò·ûì·üí·ûè·û¢·û∂·ûÇ·ûò·ûÅ·üí·ûò·üÇ·ûö' },
                    { name: 'Visualizer', path: '/visualizer', key: 'visualizer', desc: '·ûî·üÜ·ûî·üí·ûõ·üÇ·ûÑ Logic ·ûë·üÖ·ûá·û∂ Flowchart' },
                    { name: 'Study', path: '/study-buddy', key: 'study', desc: '·ûò·û∑·ûè·üí·ûè·ûö·üÄ·ûì·ûü·ûº·ûè·üí·ûö AI ·ûÖ·û∑·ûè·üí·ûè·ûõ·üí·û¢' },
                    { name: 'K-IDA', path: '/kida', key: 'kida', desc: '·ûÅ·ûΩ·ûö·ûÄ·üí·ûî·û∂·ûõ·ûë·û∏·ü¢ ·ûü·ûò·üí·ûö·û∂·ûî·üã PDF' },
                    { name: 'Tutor', path: '/tutor', key: 'tutor', desc: '·ûÇ·üí·ûö·ûº AI ·ûî·ûÑ·üí·ûö·üÄ·ûì·û±·üí·ûô·ûó·üí·ûõ·û∫·ûó·üí·ûì·üÇ·ûÄ' }
                ];
                %>

                <% tools.forEach(tool => { %>
                    <div class="relative group/link">
                        <% if (locals.user) { %>
                            <a href="<%= tool.path %>" class="<%= pageKey === tool.key ? 'active-link' : 'text-slate-500 hover:text-orange-400' %> transition-all duration-300">
                                <%= tool.name %>
                            </a>
                        <% } else { %>
                            <a href="javascript:void(0)" onclick="checkAuthBeforeAI()" class="text-slate-500 hover:text-orange-400 transition-all">
                                <%= tool.name %>
                            </a>
                        <% } %>
                        <span class="absolute -bottom-14 left-1/2 -translate-x-1/2 w-40 text-center text-[8px] text-orange-400 opacity-0 group-hover/link:opacity-100 transition-all pointer-events-none bg-black/90 p-3 rounded-xl border border-orange-500/20 shadow-2xl">
                            <%= tool.desc %>
                        </span>
                    </div>
                <% }); %>
                
                <a href="/history" class="<%= pageKey === 'history' ? 'active-link' : 'text-slate-500 hover:text-white' %> transition border-l border-orange-500/20 pl-10">Archive</a>
            </div>

            <div class="flex items-center gap-6">
                <% if (locals.user) { %>
                    <div class="relative profile-group">
                        <div class="flex items-center gap-4 cursor-pointer">
                            <div class="hidden md:flex flex-col items-end">
                                <span class="text-[10px] font-black text-white uppercase tracking-widest"><%= user.displayName %></span>
                                <span class="text-[8px] text-orange-500 font-mono uppercase tracking-tighter">Pilot Core Active</span>
                            </div>
                            <img src="<%= user.photoURL && user.photoURL !== '' ? user.photoURL : 'https://api.dicebear.com/7.x/bottts/svg?seed=' + user.displayName %>" 
                                 class="w-11 h-11 rounded-2xl user-avatar object-cover bg-black" alt="Profile">
                        </div>

                        <div class="dropdown-content">
                            <div class="dropdown-inner">
                                <div class="space-y-1">
                                    <a href="/dashboard" class="flex items-center gap-3 p-4 rounded-2xl hover:bg-orange-500/10 text-[10px] font-bold uppercase tracking-widest text-slate-300 hover:text-orange-400 transition-all">
                                        <span>üìä</span> Dashboard Hub
                                    </a>
                                    <a href="/user/profile" class="flex items-center gap-3 p-4 rounded-2xl hover:bg-orange-500/10 text-[10px] font-bold uppercase tracking-widest text-slate-300 hover:text-orange-400 transition-all">
                                        <span>‚öôÔ∏è</span> Pilot Control
                                    </a>
                                    <div class="h-px bg-white/5 my-2 mx-4"></div>
                                    <a href="/logout" class="flex items-center gap-3 p-4 rounded-2xl hover:bg-red-500/10 text-[10px] font-black uppercase tracking-widest text-red-500 transition-all">
                                        <span>üíÄ</span> Eject Identity
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                <% } else { %>
                    <a href="/login" class="px-8 py-3 bg-orange-600/10 border border-orange-600/20 rounded-2xl text-[10px] font-black uppercase tracking-widest text-orange-500 hover:bg-orange-600 hover:text-black transition-all shadow-2xl shimmer-fire">
                        Ignite Core
                    </a>
                <% } %>
            </div>
        </div>

        <div class="flex lg:hidden gap-8 mt-6 overflow-x-auto pb-4 text-[9px] font-black uppercase tracking-[0.2em] no-scrollbar border-t border-white/5 pt-6">
            <% tools.forEach(tool => { %>
                <a href="<%= locals.user ? tool.path : 'javascript:void(0)' %>" 
                   onclick="<%= locals.user ? '' : 'checkAuthBeforeAI()' %>"
                   class="<%= pageKey === tool.key ? 'active-link' : 'text-slate-500' %> whitespace-nowrap">
                    <%= tool.name %>
                </a>
            <% }); %>
            <a href="/history" class="<%= pageKey === 'history' ? 'active-link' : 'text-slate-500' %> whitespace-nowrap">Archive</a>
        </div>
    </nav>

    <script>
    /**
     * Mobile Dropdown Toggle Fix
     */
    document.addEventListener('DOMContentLoaded', () => {
        const profileGroup = document.querySelector('.profile-group');
        if (profileGroup) {
            profileGroup.addEventListener('click', function(e) {
                if (window.innerWidth < 1024) {
                    e.stopPropagation();
                    this.classList.toggle('active');
                }
            });
        }
        document.addEventListener('click', () => {
            if (profileGroup) profileGroup.classList.remove('active');
        });
    });

    /**
     * üîê FUN & COOL AUTH GUARD (·ûá·û∂·ûò·ûΩ·ûô·ûö·ûº·ûî Pepe!)
     */
    function checkAuthBeforeAI() {
        Swal.fire({
            title: '·û¢·ûè·üã·ûë·û∂·ûì·üã Login ·û†·û∏? üòπ',
            text: "·ûÖ·ûº·ûõ·ûÇ·ûé·ûì·û∏·ûü·û∑·ûì·ûò·ûÄ·ûò·üÅ ·ûä·ûæ·ûò·üí·ûî·û∏·ûî·üí·ûö·ûæ AI ·ûî·û∂·ûì·ûñ·üÅ·ûâ·ûõ·üÅ·ûâ ·û†·ûæ·ûô·ûö·û∏·ûÄ·ûö·û∂·ûô·ûá·û∂·ûò·ûΩ·ûô·ûò·ûª·ûÅ·ûÑ·û∂·ûö·ûñ·û∑·ûü·üÅ·ûü·üó! Enjoy! üî•",
            imageUrl: '/images/1.png', // ·ûè·üí·ûö·ûº·ûú·ûî·üí·ûö·û∂·ûÄ·ûä·ûê·û∂·ûò·û∂·ûì·ûö·ûº·ûî·ûì·üÅ·üá·ûÄ·üí·ûì·ûª·ûÑ folder /public/images/
            imageWidth: 150,
            imageHeight: 150,
            imageAlt: 'Pepe Enjoying',
            // ·ûÖ·ûõ·ûì·û∂ Animate.css ·ûâ·üâ·û∂·ûÄ·üã·ûü·û∂·ûÖ·üã!
            showClass: {
                popup: 'animate__animated animate__bounceInDown'
            },
            hideClass: {
                popup: 'animate__animated animate__bounceOutUp'
            },
            // ·ûü·üí·ûë·û∏·ûõ Robot Fire Cool Cool
            background: '#020617',
            color: '#f3f4f6',
            showCancelButton: true,
            confirmButtonText: 'Ignite Core (Login)',
            cancelButtonText: '·ûÖ·û∂·üÜ·ûî·ûì·üí·ûè·û∑·ûÖ',
            confirmButtonColor: '#ff4d00',
            cancelButtonColor: '#334155',
            customClass: {
                popup: 'rounded-[3rem] border-4 border-orange-500/30 shadow-[0_0_50px_rgba(255,77,0,0.4)]',
                title: 'font-black italic text-2xl text-orange-500',
                image: 'rounded-2xl mt-4 border-2 border-orange-500/20'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/login';
            }
        });
    }
    </script>
</body>
</html>