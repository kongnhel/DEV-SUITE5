<%- include('partials/header') %>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
  :root {
    --primary: <%= theme || "#8b5cf6" %>;
    --secondary: #06b6d4;
    --bg-dark: #020617;
    --magic-glow: rgba(139, 92, 246, 0.3);
  }

  body {
    font-family: 'Plus Jakarta Sans', "Kantumruy Pro", sans-serif;
    background-color: var(--bg-dark);
    color: #f1f5f9;
    overflow-x: hidden;
  }

  /* áŸ¢. Interactive Magic Background */
  #neural-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -20; opacity: 0.25; }
  .hero-glow { background: radial-gradient(circle at 50% 0%, rgba(139, 92, 246, 0.15) 0%, transparent 70%); }

  /* áŸ£. Magic Card Architecture */
  .magic-card {
    position: relative;
    background: rgba(15, 23, 42, 0.6);
    backdrop-filter: blur(30px);
    border-radius: 40px;
    z-index: 1;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
  .magic-card::before {
    content: "";
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: conic-gradient(from 0deg, transparent, var(--primary), transparent 30%);
    animation: rotateMagic 10s linear infinite;
    z-index: -1;
    opacity: 0.15;
  }
  @keyframes rotateMagic { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

  /* áŸ¤. Shimmer & UI Animations */
  .shimmer-text {
    background: linear-gradient(90deg, #fff, var(--primary), var(--secondary), #fff);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine 5s linear infinite;
  }
  @keyframes shine { to { background-position: 200% center; } }

  .float-ui { animation: float 4s ease-in-out infinite; }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

  .avatar-ring {
    position: relative;
    padding: 6px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 2.5rem;
    box-shadow: 0 0 30px var(--magic-glow);
  }

  /* Status Badges */
  .neural-badge {
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.2);
    color: var(--primary);
    padding: 6px 16px;
    border-radius: 99px;
    font-size: 10px;
    font-weight: 800;
    letter-spacing: 0.1em;
  }
</style>

<canvas id="neural-bg"></canvas>
<div class="hero-glow fixed inset-0 -z-10"></div>

<main class="max-w-7xl mx-auto px-6 py-12 relative">
  <section class="magic-card rounded-[3rem] p-10 md:p-16 mb-12 animate-in fade-in slide-in-from-top-10 duration-1000">
    <div class="flex flex-col lg:flex-row items-center gap-12">
      <div class="avatar-ring float-ui">
        <img src="<%= user.photoURL && user.photoURL !== '' ? user.photoURL : 'https://api.dicebear.com/7.x/adventurer/svg?seed=' + user.displayName %>" 
             class="w-32 h-32 md:w-44 md:h-44 rounded-[2rem] object-cover bg-slate-800" alt="Profile">
      </div>
      
      <div class="text-center lg:text-left space-y-6">
        <div class="flex flex-wrap justify-center lg:justify-start gap-4">
            <span class="neural-badge uppercase">Neural Rank: Elite Architect</span>
            <span class="px-4 py-1.5 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-400 text-[10px] font-black uppercase tracking-widest">System Online</span>
        </div>
        <h2 class="text-5xl md:text-8xl font-black text-white tracking-tighter leading-none">
          áŸá½áŸáŸ’áá¸, <span class="shimmer-text italic"><%= user.displayName %></span>!
        </h2>
        <div class="max-w-2xl">
            <p class="text-xl md:text-2xl text-slate-300 font-light italic leading-relaxed">
              "áŸá¼á˜áŸáŸ’áœá¶á‚á˜á“áŸá˜á€á€á¶á“áŸ‹ <strong class="text-purple-400">Neural Control Center</strong>! ášá¶á›áŸ‹á€á¶ášá‡á‡áŸ‚á€ á‚áŸ’ášá”áŸ‹áŠá¶á“á‡á¾á„á˜áŸášáŸ€á“ á“á·á„á€á¼áŠáŠáŸ‚á›á”áŸ’á¢á¼á“á”á¶á“á”áŸ†á”áŸ’á›áŸ‚á„ áŸá»á‘áŸ’á’ááŸ‚ááŸ’ášá¼áœá”á¶á“ášá€áŸ’áŸá¶á‘á»á€á€áŸ’á“á»á„á€áŸ’ášá¶áŸ†á„á˜á¶áŸáŒá¸á‡á¸áá›á‡á¶ášáŸ€á„ášá á¼ááŸ”"
            </p>
        </div>
      </div>
    </div>
  </section>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
    <div class="magic-card p-10 group hover:scale-105 transition-all">
      <div class="text-5xl mb-6 group-hover:scale-125 transition-transform duration-500">ğŸ“š</div>
      <h3 class="text-5xl font-black text-white mb-2"><%= totalWisdom %></h3>
      <p class="text-slate-500 text-xs font-black uppercase tracking-[0.3em]">Knowledge Base Sync</p>
      <div class="mt-4 h-1 w-full bg-white/5 rounded-full overflow-hidden">
          <div class="h-full bg-purple-500 w-3/4 animate-pulse"></div>
      </div>
    </div>

    <div class="magic-card p-10 group hover:scale-105 transition-all">
      <div class="text-5xl mb-6 group-hover:scale-125 transition-transform duration-500">ğŸ¤–</div>
      <h3 class="text-5xl font-black text-white mb-2"><%= tutorCount %></h3>
      <p class="text-slate-500 text-xs font-black uppercase tracking-[0.3em]">Neural Interactions</p>
      <div class="mt-4 h-1 w-full bg-white/5 rounded-full overflow-hidden">
          <div class="h-full bg-cyan-400 w-1/2 animate-pulse"></div>
      </div>
    </div>

    <div class="magic-card p-10 group hover:scale-105 transition-all sm:col-span-2 lg:col-span-1">
      <div class="text-5xl mb-6 group-hover:scale-125 transition-transform duration-500">âš¡</div>
      <h3 class="text-5xl font-black text-emerald-400 mb-2 italic">Active</h3>
      <p class="text-slate-500 text-xs font-black uppercase tracking-[0.3em]">Neural Link Protocol</p>
      <div class="mt-4 h-1 w-full bg-white/5 rounded-full overflow-hidden">
          <div class="h-full bg-emerald-500 w-full"></div>
      </div>
    </div>
  </div>

  <section class="mb-16">
    <div class="flex items-center gap-6 mb-10">
        <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.5em] whitespace-nowrap">System Capabilities</h4>
        <div class="h-px w-full bg-gradient-to-r from-slate-800 to-transparent"></div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="magic-card p-8 bg-purple-500/5">
            <h5 class="text-purple-400 font-bold mb-3 uppercase text-xs">ğŸš€ Ultra-Fast Analysis</h5>
            <p class="text-sm text-slate-400 italic font-light">ášá¶á›áŸ‹áŸáŸ†áá½ášášá”áŸáŸ‹á”áŸ’á¢á¼á“ ááŸ’ášá¼áœá”á¶á“áœá·á—á¶á‚áŠáŸ„á™ Gemini 1.5 Flash áŠáŸ‚á›á•áŸ’áŠá›áŸ‹á…á˜áŸ’á›á¾á™á›á¿á“á”áŸ†á•á»á á˜á·á“á±áŸ’á™á”áŸ’á¢á¼á“á…á¶áŸ†á™á¼ášá¡á¾á™!</p>
        </div>
        <div class="magic-card p-8 bg-cyan-500/5">
            <h5 class="text-cyan-400 font-bold mb-3 uppercase text-xs">ğŸ§  Memory Persistence</h5>
            <p class="text-sm text-slate-400 italic font-light">á”áŸ’ášá–áŸá“áŸ’á’ Dashboard á“áŸáŸ‡á“á¹á„ášáŸ€á”ášá¶á”áŸ‹á–á¸á‚áŸ’ášá”áŸ‹áŸá€á˜áŸ’á˜á—á¶á–á”áŸ’á¢á¼á“ á‡á½á™á±áŸ’á™á”áŸ’á¢á¼á“á„á¶á™áŸáŸ’ášá½á›áŸáŸ’áœáŸ‚á„ášá€á˜áŸášáŸ€á“áŠáŸ‚á›á”á¶á“ášáŸ€á“ášá½á…áŸ”</p>
        </div>
    </div>
  </section>

  <div class="space-y-8">
    <div class="flex justify-between items-center mb-10">
        <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.5em]">Neural Footprints (Recent)</h4>
        <a href="/history" class="text-[10px] font-black text-purple-400 uppercase tracking-widest hover:text-white transition-all">View Full Archive â†’</a>
    </div>

    <div class="grid gap-6">
      <% recentActivity.forEach(act => { %>
        <div class="magic-card p-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-6 border-l-[10px] border-purple-500/30 hover:border-purple-500 transition-all">
          <div class="flex-1 space-y-3">
            <p class="text-white font-light text-2xl italic leading-relaxed">"<%= act.userInput %>"</p>
            <div class="flex items-center gap-4">
              <span class="text-[9px] bg-white/5 px-3 py-1 rounded-full text-slate-400 border border-white/10 font-mono uppercase tracking-widest"><%= act.toolName %></span>
              <span class="text-[9px] text-slate-500 uppercase font-bold tracking-tighter">Sync Date: <%= new Date(act.createdAt).toLocaleDateString() %></span>
            </div>
          </div>
          <a href="/history" class="w-full md:w-auto text-center px-10 py-4 rounded-2xl bg-white/5 hover:bg-purple-600 hover:text-white border border-white/10 text-purple-400 text-xs font-black transition-all active:scale-90 uppercase tracking-widest shadow-xl">
            Analyze Log
          </a>
        </div>
      <% }) %>
      
      <% if (recentActivity.length === 0) { %>
        <div class="text-center py-20 opacity-30">
            <p class="text-xl font-black italic uppercase tracking-[0.3em]">No Activity Detected in Neural Node</p>
            <p class="text-sm mt-2">ááŸ„áŸ‡á…á¶á”áŸ‹á•áŸ’áŠá¾á˜á”áŸáŸá€á€á˜áŸ’á˜ášáŸ€á“áŸá¼ááŸ’ášá‡á¶á˜á½á™ AI á‘á¶áŸ†á„á¢áŸáŸ‹á‚áŸ’á“á¶!</p>
        </div>
      <% } %>
    </div>
  </div>
</main>

<%- include('partials/footer') %>

<script>
  // áŸ¡. Interactive Particle Background (Mouse Follow)
  const canvas = document.getElementById("neural-bg");
  const ctx = canvas.getContext("2d");
  let dots = [];
  let mouse = { x: null, y: null };
  window.addEventListener("mousemove", (e) => { mouse.x = e.x; mouse.y = e.y; });

  function init() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    dots = [];
    for (let i = 0; i < 80; i++) {
      dots.push({ 
          x: Math.random() * canvas.width, 
          y: Math.random() * canvas.height, 
          vx: (Math.random() - 0.5) * 0.5, 
          vy: (Math.random() - 0.5) * 0.5, 
          size: Math.random() * 2 
      });
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "<%= theme || '#8b5cf6' %>";
    ctx.strokeStyle = "rgba(139, 92, 246, 0.05)";
    dots.forEach(d => {
      d.x += d.vx; d.y += d.vy;
      if (d.x < 0 || d.x > canvas.width) d.vx *= -1; if (d.y < 0 || d.y > canvas.height) d.vy *= -1;
      
      // Connect to mouse
      let dist = Math.hypot(mouse.x - d.x, mouse.y - d.y);
      if (dist < 150) { ctx.beginPath(); ctx.moveTo(d.x, d.y); ctx.lineTo(mouse.x, mouse.y); ctx.stroke(); }
      
      ctx.beginPath(); ctx.arc(d.x, d.y, d.size, 0, Math.PI * 2); ctx.fill();
    });
    requestAnimationFrame(draw);
  }
  init(); draw();
  window.addEventListener("resize", init);
</script>