<%- include('partials/header') %>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
  :root {
    --primary: #ff4d00; /* á–ááŸŒá—áŸ’á›á¾á„á€áŸ’áŠáŸ…ááŸ’á›á¶áŸ†á„ */
    --secondary: #ff9100;
    --bg: #020617;
    --danger: #ff0000;
    --robot-glow: rgba(255, 77, 0, 0.4);
    --metal-plate: rgba(30, 41, 59, 0.7);
  }
  body {
    font-family: "Kantumruy Pro", sans-serif;
    background-color: var(--bg);
    color: #f3f4f6;
    overflow-x: hidden;
  }

  /* áŸ¡. Fiery Neural Background */
  #neural-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -20;
    opacity: 0.4;
  }
  .heat-haze {
    position: fixed;
    inset: 0;
    background: radial-gradient(
      circle at 50% 50%,
      rgba(255, 77, 0, 0.05) 0%,
      transparent 80%
    );
    z-index: -10;
    pointer-events: none;
  }

  /* áŸ¢. Robotic Plating Card */
  .robot-card {
    position: relative;
    background: var(--metal-plate);
    backdrop-filter: blur(25px);
    border-radius: 40px;
    z-index: 1;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
  }

  /* áŸ£. Fire Border Animation */
  .robot-card::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(
      from 0deg,
      transparent,
      var(--primary),
      var(--secondary),
      transparent 40%
    );
    animation: rotateFire 4s linear infinite;
    z-index: -1;
    opacity: 0.5;
  }
  @keyframes rotateFire {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* áŸ¤. Robot Scanning Effect */
  .scan-line {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(
      to right,
      transparent,
      var(--primary),
      transparent
    );
    animation: scanMove 3s linear infinite;
    opacity: 0.3;
    z-index: 2;
  }
  @keyframes scanMove {
    0% {
      top: -10%;
    }
    100% {
      top: 110%;
    }
  }

  /* áŸ¥. Infernal Avatar Shield */
  .avatar-inferno {
    position: relative;
    width: 180px;
    height: 180px;
    margin: 0 auto;
    padding: 8px;
    background: linear-gradient(45deg, var(--primary), #fff, var(--secondary));
    border-radius: 45px;
    box-shadow: 0 0 30px var(--robot-glow);
    animation: pulseFire 2s infinite alternate;
  }
  @keyframes pulseFire {
    from {
      transform: scale(1);
      box-shadow: 0 0 20px var(--robot-glow);
    }
    to {
      transform: scale(1.05);
      box-shadow: 0 0 40px var(--primary);
    }
  }

  .avatar-inner {
    width: 100%;
    height: 100%;
    background: var(--bg);
    border-radius: 38px;
    overflow: hidden;
    border: 2px solid rgba(0, 0, 0, 0.5);
  }
  #avatarPreview {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: contrast(1.1);
  }

  /* áŸ¦. Burning UI Elements */
  .shimmer-fire {
    background: linear-gradient(
      90deg,
      #fff,
      var(--primary),
      var(--secondary),
      #fff
    );
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: fireShine 3s linear infinite;
  }
  @keyframes fireShine {
    to {
      background-position: 200% center;
    }
  }

  .input-robot {
    background: rgba(0, 0, 0, 0.6) !important;
    border: 1px solid rgba(255, 77, 0, 0.2) !important;
    border-radius: 20px;
    color: white;
    transition: all 0.3s ease;
  }
  .input-robot:focus {
    border-color: var(--primary) !important;
    box-shadow: 0 0 25px var(--robot-glow);
  }

  .btn-ignite {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: #000;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 2px;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 0 20px var(--robot-glow);
  }
  .btn-ignite:hover:not(:disabled) {
    transform: scale(1.05) translateY(-5px);
    box-shadow: 0 0 50px var(--primary);
  }
</style>

<canvas id="neural-bg"></canvas>
<div class="heat-haze"></div>

<main class="max-w-7xl mx-auto p-6 md:p-12 relative">
  <header
    class="text-center mb-20 space-y-8 animate-in fade-in zoom-in duration-1000"
  >
    <div
      class="inline-flex items-center gap-3 px-6 py-2 rounded-full bg-orange-500/10 border border-orange-500/20"
    >
      <span class="w-3 h-3 rounded-full bg-orange-500 animate-pulse"></span>
      <span class="text-orange-500 text-xs font-black tracking-widest uppercase"
        >System Status: Overheating ğŸ”¥</span
      >
    </div>

    <h2
      class="text-6xl md:text-9xl font-black tracking-tighter shimmer-fire leading-none italic uppercase"
    >
      ROBOT PROFILE
    </h2>

    <div class="max-w-3xl mx-auto space-y-6">
      <p class="text-2xl md:text-4xl font-light text-white leading-tight">
        "á”á‰áŸ’á‡á¶ Robot ášá”áŸáŸ‹á”áŸ’á¢á¼á“ á‡á¶á˜á½á™
        <span class="text-orange-500 font-bold">áá¶á˜á–á›á—áŸ’á›á¾á„á“ášá€</span>!"
      </p>
      <p class="text-lg text-slate-400 italic leading-relaxed px-4">
        áá¾á”áŸ’á¢á¼á“á…á„áŸ‹á±áŸ’á™ Identity ášá”áŸáŸ‹á”áŸ’á¢á¼á“á†áŸáŸ‡áŸá“áŸ’á’áŸ„áŸá“áŸ’á’áŸ…á€áŸ’á“á»á„á–á·á—á– AI á˜áŸ‚á“á‘áŸ? á”á„ášáŸ€á”á…áŸ†
        Engine ááŸ’á˜á¸á±áŸ’á™á á¾á™! á€á¶ášá¢á¶á”áŸ‹áŠáŸá Profile á“áŸ…á‘á¸á“áŸáŸ‡ á“á¹á„á’áŸ’áœá¾á±áŸ’á™ AI áŸáŸ’á‚á¶á›áŸ‹á–á¸
        "á€á˜áŸ’áŠáŸ…" á“áŸƒá…áŸ†ááŸáŸ‡áŠá¹á„á”áŸ’á¢á¼á“á€á¶á“áŸ‹ááŸ‚á…áŸ’á”á¶áŸáŸ‹! á”á‰áŸ’á…á¼á›á‘á·á“áŸ’á“á“áŸá™á˜á€á˜áŸá€á»á›áŸá˜áŸ’á–áŸá“áŸ’á’! ğŸ˜‚
      </p>
    </div>
  </header>

  <div class="max-w-2xl mx-auto">
    <div class="robot-card p-10 md:p-16 space-y-12 shadow-2xl">
      <div class="scan-line"></div>

      <div class="text-center relative z-10">
        <div class="avatar-inferno mb-10 group">
          <div class="avatar-inner">
            <img
              id="avatarPreview"
              src="<%= user.photoURL && user.photoURL !== '' ? user.photoURL : 'https://api.dicebear.com/7.x/bottts/svg?seed=' + user.displayName %>"
              alt="Robot Profile"
            />
          </div>
          <div
            class="absolute -top-4 -right-4 bg-orange-600 text-white text-[8px] font-black px-3 py-1 rounded-md rotate-12 shadow-lg"
          >
            CORE_ACTIVE
          </div>
        </div>
        <p
          class="text-[10px] text-orange-500 font-black uppercase tracking-[0.5em]"
        >
          Neural Identity Processor
        </p>
      </div>

      <form id="profileForm" class="space-y-10 relative z-10">
        <div class="space-y-8">
          <div class="relative group">
            <label
              class="block text-[10px] font-black text-orange-400 uppercase tracking-widest mb-3 ml-2"
              >Pilot Display Name</label
            >
            <input
              type="text"
              id="displayName"
              value="<%= user.displayName %>"
              class="input-robot w-full px-6 py-5 outline-none text-base"
              placeholder="áˆáŸ’á˜áŸ„áŸ‡á¢áŸ’á“á€á”á‰áŸ’á‡á¶ Robot..."
              required
            />
          </div>

          <div class="relative group">
            <label
              class="block text-[10px] font-black text-orange-400 uppercase tracking-widest mb-3 ml-2"
              >Neural Skin URL (Photo)</label
            >
            <input
              type="text"
              id="photoURL"
              value="<%= user.photoURL %>"
              oninput="updatePreview(this.value)"
              class="input-robot w-full px-6 py-5 outline-none text-base"
              placeholder="á”á·á‘á—áŸ’á‡á¶á”áŸ‹ Link ášá¼á”á—á¶á– Epic..."
            />
          </div>
        </div>

        <button
          type="submit"
          id="submitBtn"
          class="btn-ignite w-full py-6 rounded-[25px] text-[11px] active:scale-95 shadow-lg"
        >
          Sync Core with Infernal Energy
        </button>
      </form>

      <div
        class="bg-red-950/20 border border-red-500/20 rounded-[35px] p-8 space-y-6 relative z-10"
      >
        <div class="flex items-center gap-4">
          <span class="text-3xl animate-bounce">â˜¢ï¸</span>
          <div>
            <h3
              class="text-red-500 font-black uppercase text-[10px] tracking-widest"
            >
              Self-Destruct Zone
            </h3>
            <p class="text-slate-500 text-[9px] uppercase tracking-tighter">
              á€á˜áŸ’á‘áŸá…ášá¶á›áŸ‹á‘á·á“áŸ’á“á“áŸá™ Robot ášá”áŸáŸ‹á”áŸ’á¢á¼á“á…áŸ„á›á‘á¶áŸ†á„áŸáŸ’ášá»á„
            </p>
          </div>
        </div>

        <button
          onclick="confirmDelete()"
          class="w-full py-4 border border-red-500/40 bg-red-600/10 text-red-500 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-red-600 hover:text-white transition-all"
        >
          Initiate Self-Destruction
        </button>
      </div>

      <div class="text-center pt-6 border-t border-white/5 relative z-10">
        <a
          href="/dashboard"
          class="text-[10px] text-orange-500/50 hover:text-orange-400 uppercase tracking-widest transition-all italic"
        >
          â† Return to Command Center
        </a>
      </div>
    </div>
  </div>
</main>

<%- include('partials/footer') %>

<script>
  const socket = io();

  // áŸ¡. Interactive Fire Particles (Mouse Follow)
  const canvas = document.getElementById("neural-bg");
  const ctx = canvas.getContext("2d");
  let dots = [];
  let mouse = { x: null, y: null };
  window.addEventListener("mousemove", (e) => {
    mouse.x = e.x;
    mouse.y = e.y;
  });

  function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    dots = [];
    for (let i = 0; i < 80; i++) {
      dots.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        vx: (Math.random() - 0.5) * 0.6,
        vy: (Math.random() - 1) * 0.8, // á áŸ„áŸ‡á¡á¾á„á›á¾áŠá¼á…á•áŸ’áŸáŸ‚á„
        size: Math.random() * 3,
      });
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    dots.forEach((d) => {
      d.x += d.vx;
      d.y += d.vy;
      if (d.y < 0) d.y = canvas.height; // á…áŸá‰á–á¸á›á¾á…á¼á›á€áŸ’ášáŸ„á˜áœá·á‰
      if (d.x < 0 || d.x > canvas.width) d.vx *= -1;

      // Connect points with Fire lines
      let dist = Math.hypot(mouse.x - d.x, mouse.y - d.y);
      if (dist < 120) {
        ctx.strokeStyle = `rgba(255, 77, 0, ${1 - dist / 120})`;
        ctx.beginPath();
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(mouse.x, mouse.y);
        ctx.stroke();
      }

      ctx.fillStyle = d.size > 2 ? "#ff4d00" : "#ff9100";
      ctx.beginPath();
      ctx.arc(d.x, d.y, d.size, 0, Math.PI * 2);
      ctx.fill();
    });
    requestAnimationFrame(draw);
  }
  init();
  draw();
  window.addEventListener("resize", init);

  // áŸ¢. Logic á”áŸ’á¢á¼á“áŠá¼á…á˜á»á“ á‚áŸ’ášá¶á“áŸ‹ááŸ‚á”áŸ’áá¼ášá–ááŸŒ
  function updatePreview(url) {
    const preview = document.getElementById("avatarPreview");
    if (url) {
      preview.src = url;
      preview.onerror = () => {
        preview.src = "https://api.dicebear.com/7.x/bottts/svg?seed=fire-robot";
      };
    }
  }

  function confirmDelete() {
    Swal.fire({
      title: "â˜¢ï¸ á”áŸ’ášá™áŸááŸ’á“á˜áŸ!",
      text: "Robot á”áŸ’á¢á¼á“á“á¹á„ááŸ’ášá¼áœášá›á¶á™á‡á¶á•áŸáŸ‡á‡á¶ášáŸ€á„ášá á¼á! áá¾á”áŸ’á¢á¼á“á”áŸ’ášá¶á€áŠá‘áŸ?",
      icon: "warning",
      background: "#020617",
      color: "#fff",
      showCancelButton: true,
      confirmButtonColor: "#ff4d00",
      cancelButtonText: "á‘á»á€áŸá·á“á”á„!",
      confirmButtonText: "á€á˜áŸ’á‘áŸá…áœá¶á‘áŸ…!",
    }).then(async (result) => {
      if (result.isConfirmed) {
        try {
          const res = await fetch("/user/delete-account", { method: "POST" });
          if (res.ok) {
            window.location.href = "/login";
          }
        } catch (err) {
          showError(err.message);
        }
      }
    });
  }

  document
    .getElementById("profileForm")
    .addEventListener("submit", async (e) => {
      e.preventDefault();
      const btn = document.getElementById("submitBtn");
      btn.disabled = true;
      btn.innerText = "IGNITING CORE...";
      const data = {
        displayName: document.getElementById("displayName").value,
        photoURL: document.getElementById("photoURL").value,
      };

      try {
        const res = await fetch("/user/update-profile", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
        const result = await res.json();
        if (result.status === "success") {
          Swal.fire({
            icon: "success",
            title: "CORE SYNCED!",
            text: "Robot á”áŸ’á¢á¼á“ááŸ’ášá¼áœá”á¶á“ Upgrade ášá½á…ášá¶á›áŸ‹!",
            background: "#020617",
            color: "#fff",
            confirmButtonColor: "#ff4d00",
          });
        }
      } catch (error) {
        showError(error.message);
      } finally {
        btn.disabled = false;
        btn.innerText = "Sync Core with Infernal Energy";
      }
    });

  function showError(msg) {
    Swal.fire({
      icon: "error",
      title: "System Error",
      text: msg,
      background: "#020617",
      color: "#fff",
    });
  }
</script>
