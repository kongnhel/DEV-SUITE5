<%- include('partials/header') %>

<style>
  :root {
    --primary: <%= theme || "#00f2ff" %>;
    --secondary: #7000ff;
    --bg: #030712;
    --magic-glow: rgba(0, 242, 255, 0.3);
  }
  body {
    font-family: "Kantumruy Pro", sans-serif;
    background-color: var(--bg);
    color: #f3f4f6;
    overflow-x: hidden;
  }

  /* áŸ¡. Interactive Magic Background */
  #neural-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -20;
    opacity: 0.25;
  }
  .marketing-gradient {
    background: radial-gradient(
      circle at 50% 50%,
      rgba(56, 189, 248, 0.1) 0%,
      transparent 80%
    );
  }

  /* áŸ¢. Magic Card Architecture */
  .magic-card {
    position: relative;
    background: rgba(15, 23, 42, 0.6);
    backdrop-filter: blur(30px);
    border-radius: 40px;
    z-index: 1;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }
  .magic-card::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(
      from 0deg,
      transparent,
      var(--primary),
      transparent 30%
    );
    animation: rotateMagic 6s linear infinite;
    z-index: -1;
    opacity: 0.2;
  }
  @keyframes rotateMagic {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* áŸ£. UI Glow & Shimmer */
  .shimmer-text {
    background: linear-gradient(
      90deg,
      #fff,
      var(--primary),
      var(--secondary),
      #fff
    );
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: shine 5s linear infinite;
  }
  @keyframes shine {
    to {
      background-position: 200% center;
    }
  }

  .float-ui {
    animation: float 4s ease-in-out infinite;
  }
  @keyframes float {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  /* Mode Buttons */
  .mode-btn {
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  .mode-btn.active {
    background: var(--primary);
    color: #000;
    font-weight: 900;
    box-shadow: 0 0 30px var(--primary);
    transform: scale(1.05);
  }

  .btn-magic {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: #000;
    font-weight: 900;
    transition: all 0.4s ease;
    box-shadow: 0 0 20px var(--magic-glow);
  }
  .btn-magic:hover {
    transform: scale(1.02);
    box-shadow: 0 0 40px var(--primary);
  }

  .point-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 24px;
    transition: 0.4s;
  }
  .point-card:hover {
    border-color: var(--primary);
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }
</style>

<canvas id="neural-bg"></canvas>
<div class="marketing-gradient fixed inset-0 -z-10"></div>

<main class="max-w-7xl mx-auto p-4 md:p-12 relative">
  <header
    class="text-center mb-20 space-y-10 animate-in fade-in zoom-in duration-1000"
  >
    <div
      class="inline-flex items-center gap-3 px-6 py-2 rounded-full bg-cyan-500/10 border border-cyan-500/20 float-ui"
    >
      <span class="w-2 h-2 rounded-full bg-cyan-400 animate-ping"></span>
      <span class="text-cyan-400 text-xs font-black tracking-widest uppercase"
        >ğŸ§  AI Tutor: Neural Intelligence V2.6</span
      >
    </div>

    <h1
      class="text-6xl md:text-9xl font-black shimmer-text italic uppercase leading-none"
    >
      AI TUTOR
    </h1>

    <div class="max-w-4xl mx-auto space-y-8">
      <p class="text-3xl md:text-5xl font-light text-white leading-tight">
        "áˆá”áŸ‹á”á¶ášá˜áŸ’á—ášá¿á„á˜áŸášáŸ€á“áŸáŸ’á˜á»á‚áŸáŸ’á˜á¶á‰! á±áŸ’á™á”á„ AI á€áŸ’á›á¶á™á‡á¶
        <span class="text-cyan-400 font-bold">á˜á“áŸ’áá¢á¶á‚á˜</span> á“áŸƒá…áŸ†ááŸáŸ‡áŠá¹á„á”áŸ’á¢á¼á“!"
      </p>
      <p
        class="text-lg md:text-xl text-slate-400 font-light italic leading-relaxed px-4"
      >
        áá¾á”áŸ’á¢á¼á“á’áŸ’á›á¶á”áŸ‹á˜á¶á“á¢á¶ášá˜áŸ’á˜ááŸáá¶ á˜áŸášáŸ€á“á“áŸ…áŸá¶á›á¶á–á·á”á¶á€á™á›áŸ‹á–áŸá€á˜áŸ‚á“á‘áŸ?
        <strong class="text-cyan-400">AI Tutor</strong> á“á¹á„á”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹
        <span class="underline decoration-cyan-500/30">Neural-Sync</span>
        áŠá¾á˜áŸ’á”á¸á”áŸ†á”áŸ’á›áŸ‚á„á…áŸ†ááŸáŸ‡áŠá¹á„á€áŸ’ášá¶áŸáŸ‹áŸ— á±áŸ’á™á€áŸ’á›á¶á™á‡á¶á…áŸ†áá¸áá½ášá€áŸ’á”á¶á›áŠáŸá„á¶á™áŸáŸ’ášá½á›á”áŸ†á•á»ááŸ”
        á˜á·á“áá¶á”áŸ’á¢á¼á“á…á„áŸ‹ášáŸ€á“á”áŸ‚á”á€áŸ’á˜áŸá„á˜ááŸ’ááŸá™áŸ’á™ á¬á”áŸ‚á”áŸá¶á˜á‰áŸ’á‰ á‚áŸ’ášá¶á“áŸ‹ááŸ‚áŸá½ášá˜á€ á…á¶áŸ†á”á„á‡á½á™! ğŸ˜‚
      </p>
    </div>

    <div class="flex flex-wrap justify-center gap-10 pt-6">
      <div class="flex items-center gap-4 magic-card p-4 px-8">
        <span class="text-3xl">âš¡</span>
        <div class="text-left">
          <p class="text-xs font-black text-white uppercase tracking-widest">
            Fast Learning
          </p>
          <p class="text-[10px] text-slate-400">áŸá„áŸ’ááŸá”á˜áŸášáŸ€á“á€áŸ’á“á»á„ áŸ£ áœá·á“á¶á‘á¸</p>
        </div>
      </div>
      <div class="flex items-center gap-4 magic-card p-4 px-8">
        <span class="text-3xl">ğŸ§¸</span>
        <div class="text-left">
          <p class="text-xs font-black text-white uppercase tracking-widest">
            Kid-Friendly
          </p>
          <p class="text-[10px] text-slate-400">á–á“áŸ’á™á›áŸ‹á„á¶á™áŸ—áŠá›áŸ‹á€áŸ’á˜áŸá„áŸ—</p>
        </div>
      </div>
      <div class="flex items-center gap-4 magic-card p-4 px-8">
        <span class="text-3xl">ğŸ¯</span>
        <div class="text-left">
          <p class="text-xs font-black text-white uppercase tracking-widest">
            Point Focus
          </p>
          <p class="text-[10px] text-slate-400">áŸá˜áŸ’ášá¶áŸ†á„á™á€ááŸ‚á…áŸ†áá»á…áŸáŸ†áá¶á“áŸ‹</p>
        </div>
      </div>
    </div>
  </header>

  <div
    class="magic-card p-8 md:p-16 space-y-12 shadow-2xl relative overflow-hidden"
  >
    <div class="space-y-10">
      <div class="flex flex-col md:flex-row justify-between items-center gap-8">
        <div class="text-left w-full md:w-auto">
          <h2 class="text-2xl font-black text-white uppercase tracking-tighter">
            á…á¶á”áŸ‹á•áŸ’áŠá¾á˜á”áŸáŸá€á€á˜áŸ’á˜ášáŸ€á“áŸá¼ááŸ’áš
          </h2>
          <p class="text-sm text-slate-500">
            á‡áŸ’ášá¾áŸášá¾áŸášá”áŸ€á”áŠáŸ‚á›á”áŸ’á¢á¼á“á…á„áŸ‹á±áŸ’á™á”á„ AI á”á€áŸáŸ’ášá¶á™
          </p>
        </div>
        <div class="flex gap-4 w-full md:w-auto">
          <button
            onclick="setMode('kid', this)"
            class="mode-btn flex-1 md:flex-none px-10 py-5 rounded-2xl text-xs font-black uppercase tracking-widest active"
          >
            ğŸ‘¶ Kid Mode
          </button>
          <button
            onclick="setMode('simple', this)"
            class="mode-btn flex-1 md:flex-none px-10 py-5 rounded-2xl text-xs font-black uppercase tracking-widest"
          >
            ğŸ’¡ Simple Mode
          </button>
        </div>
      </div>

      <div class="relative group">
        <input
          type="text"
          id="topicInput"
          class="w-full bg-black/60 border border-white/5 rounded-3xl px-10 py-8 outline-none focus:border-cyan-400 text-xl text-white transition-all shadow-inner placeholder:text-slate-800"
          placeholder="á”á‰áŸ’á…á¼á›á”áŸ’ášá’á¶á“á”á‘áŠáŸ‚á›á”áŸ’á¢á¼á“á…á„áŸ‹á…áŸáŸ‡... (á§. Quantum Physics)"
        />
        <button
          onclick="askTutor()"
          class="md:absolute right-4 top-4 bottom-4 mt-6 md:mt-0 w-full md:w-auto btn-magic px-12 rounded-2xl font-black text-sm uppercase tracking-widest active:scale-90"
        >
          Generate Wisdom
        </button>
      </div>
    </div>

    <div id="loading" class="hidden flex flex-col items-center py-24">
      <div class="relative w-24 h-24 mb-10">
        <div
          class="absolute inset-0 border-8 border-white/5 rounded-full"
        ></div>
        <div
          class="absolute inset-0 border-8 border-t-cyan-500 rounded-full animate-spin"
        ></div>
      </div>
      <p
        class="text-cyan-500 font-mono text-sm tracking-[0.5em] animate-pulse uppercase"
      >
        Syncing_Knowledge_Database...
      </p>
    </div>

    <div
      id="answerArea"
      class="hidden space-y-16 animate-in zoom-in-95 duration-700"
    >
      <div
        class="p-10 md:p-16 bg-white/5 rounded-[60px] border-l-[15px] border-cyan-400"
      >
        <h3
          id="resTitle"
          class="text-4xl md:text-8xl font-black text-cyan-400 mb-10 uppercase italic leading-none"
        ></h3>
        <div
          id="resDesc"
          class="text-2xl md:text-4xl font-light text-slate-100 leading-relaxed italic pr-10"
        ></div>
      </div>

      <div
        class="grid grid-cols-1 md:grid-cols-2 gap-10"
        id="pointsContainer"
      ></div>

      <div
        class="grid grid-cols-1 lg:grid-cols-3 gap-10 pt-10 border-t border-white/5"
      >
        <div class="lg:col-span-2 space-y-10">
          <h4
            class="text-xs font-black text-yellow-500 uppercase tracking-[0.6em] flex items-center gap-5"
          >
            <span class="h-px flex-1 bg-yellow-500/20"></span> Case Studies &
            Examples
          </h4>
          <ul id="resExamples" class="space-y-10"></ul>
        </div>
        <div
          class="magic-card p-12 bg-cyan-400/5 text-center flex items-center justify-center"
        >
          <div>
            <span class="text-7xl mb-8 block float-ui">ğŸ¤©</span>
            <p
              id="resFunFact"
              class="text-xl text-cyan-200 italic font-medium leading-relaxed"
            ></p>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<%- include('partials/footer') %>

<script>
  const socket = io();
  let currentMode = "kid";

  // áŸ¡. Interactive Magic Background (Mouse Follow)
  const canvas = document.getElementById("neural-bg");
  const ctx = canvas.getContext("2d");
  let dots = [];
  let mouse = { x: null, y: null };
  window.addEventListener("mousemove", (e) => {
    mouse.x = e.x;
    mouse.y = e.y;
  });

  function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    dots = [];
    for (let i = 0; i < 70; i++) {
      dots.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        vx: (Math.random() - 0.5) * 0.4,
        vy: (Math.random() - 0.5) * 0.4,
        size: Math.random() * 1.5,
      });
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "<%= theme || '#00f2ff' %>";
    ctx.strokeStyle = "rgba(0, 242, 255, 0.05)";
    dots.forEach((d) => {
      d.x += d.vx;
      d.y += d.vy;
      if (d.x < 0 || d.x > canvas.width) d.vx *= -1;
      if (d.y < 0 || d.y > canvas.height) d.vy *= -1;

      let dist = Math.hypot(mouse.x - d.x, mouse.y - d.y);
      if (dist < 150) {
        ctx.beginPath();
        ctx.moveTo(d.x, d.y);
        ctx.lineTo(mouse.x, mouse.y);
        ctx.stroke();
      }

      ctx.beginPath();
      ctx.arc(d.x, d.y, d.size, 0, Math.PI * 2);
      ctx.fill();
    });
    requestAnimationFrame(draw);
  }
  init();
  draw();

  // áŸ¢. Tutor Logic
  function setMode(mode, btn) {
    currentMode = mode;
    document
      .querySelectorAll(".mode-btn")
      .forEach((b) => b.classList.remove("active"));
    btn.classList.add("active");
  }

  async function askTutor() {
    const topic = document.getElementById("topicInput").value.trim();
    const firebaseUid = "<%= user ? user.firebaseUid : '' %>";

    if (!topic)
      return Swal.fire({
        icon: "info",
        title: "á”áŸ’ášá¶á”áŸ‹á”á„á˜á€áá¶á…á„áŸ‹ášáŸ€á“á¢á¸? ğŸ˜‚",
        background: "#030712",
        color: "#00f2ff",
      });
    if (!firebaseUid)
      return Swal.fire({
        icon: "warning",
        title: "áŸá¼á˜á…á¼á›á‚áá“á¸áŸá·á“!",
        background: "#030712",
        color: "#ffcc00",
      });

    document.getElementById("loading").classList.remove("hidden");
    document.getElementById("answerArea").classList.add("hidden");

    socket.emit("ask_tutor", { topic, mode: currentMode, firebaseUid });
  }

  socket.on("tutor_result", (data) => {
    document.getElementById("loading").classList.add("hidden");
    document.getElementById("answerArea").classList.remove("hidden");
    document.getElementById("resTitle").innerText = data.title;
    typeWriter("resDesc", data.explanation);

    document.getElementById("pointsContainer").innerHTML = data.key_points
      .map(
        (p) => `
      <div class="point-card p-10">
        <div class="text-cyan-400 font-black text-2xl uppercase italic mb-5 underline decoration-cyan-500/20">${p.label}</div>
        <p class="text-xl text-slate-400 font-light leading-relaxed">${p.desc}</p>
      </div>
    `,
      )
      .join("");

    document.getElementById("resExamples").innerHTML = data.examples
      .map(
        (ex) => `
      <li class="flex items-start gap-8 text-slate-100 text-2xl group">
        <div class="mt-4 h-4 w-4 rounded-full bg-cyan-400 shadow-[0_0_20px_#06b6d4] group-hover:scale-150 transition-transform"></div>
        <span class="font-light leading-snug">${ex}</span>
      </li>
    `,
      )
      .join("");
    document.getElementById("resFunFact").innerText =
      "áŠá¹á„á¢ááŸ‹áá¶? " + data.fun_fact;
    document
      .getElementById("answerArea")
      .scrollIntoView({ behavior: "smooth" });
  });

  function typeWriter(id, text) {
    let i = 0;
    const el = document.getElementById(id);
    el.innerHTML = "";
    function type() {
      if (i < text.length) {
        el.innerHTML += text.charAt(i);
        i++;
        setTimeout(type, 10);
      }
    }
    type();
  }

  window.addEventListener("resize", init);
</script>
